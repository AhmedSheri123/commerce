{% extends "management_base.html" %}

{% block content %}
<section class="bg-gray-50 dark:bg-gray-900">
  <div class="mx-auto max-w-screen-xl px-4 lg:px-12 space-y-6">

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="text-sm text-gray-500">المستخدمون</div>
        <div class="text-2xl font-semibold text-gray-900">{{ users_total }}</div>
        <div class="text-xs text-gray-500">نشط: {{ users_active }} | موثق: {{ users_verified }} | مشترك: {{ users_subscribed }}</div>
      </div>
      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="text-sm text-gray-500">المنصات/الفئات/المنتجات</div>
        <div class="text-2xl font-semibold text-gray-900">{{ platforms_total }} / {{ categories_total }} / {{ products_total }}</div>
        <div class="text-xs text-gray-500">سعر إجمالي: {{ products_price_total|floatformat:2 }} | ربح إجمالي: {{ products_profit_total|floatformat:2 }}</div>
      </div>
      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="text-sm text-gray-500">المحافظ</div>
        <div class="text-2xl font-semibold text-gray-900">{{ wallets_total }}</div>
        <div class="text-xs text-gray-500">الرصيد: {{ wallets_balance_total|floatformat:6 }} | الإجمالي: {{ wallets_total_balance|floatformat:6 }}</div>
      </div>
      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="text-sm text-gray-500">الأرباح (UserProgress)</div>
        <div class="text-2xl font-semibold text-gray-900">{{ progress_earned_total|floatformat:2 }}</div>
        <div class="text-xs text-gray-500">مجموع أرباح التقدم للمستخدمين</div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="text-sm text-gray-500">الإيداعات</div>
        <div class="text-2xl font-semibold text-gray-900">{{ deposits_total }}</div>
        <div class="text-xs text-gray-500">
          إجمالي المبالغ: {{ deposits_amount_total|floatformat:6 }} |
          مؤكد: {{ deposits_amount_confirmed|floatformat:6 }} |
          قيد الانتظار: {{ deposits_pending }} |
          مرفوض: {{ deposits_rejected }}
        </div>
      </div>
      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="text-sm text-gray-500">السحوبات</div>
        <div class="text-2xl font-semibold text-gray-900">{{ withdrawals_total }}</div>
        <div class="text-xs text-gray-500">
          إجمالي المبالغ: {{ withdrawals_amount_total|floatformat:6 }} |
          معلق: {{ withdrawals_pending }} |
          موافق: {{ withdrawals_approved }} |
          مرفوض: {{ withdrawals_rejected }}
        </div>
      </div>
      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="text-sm text-gray-500">التحويلات</div>
        <div class="text-2xl font-semibold text-gray-900">{{ transfers_total }}</div>
        <div class="text-xs text-gray-500">إجمالي المبالغ: {{ transfers_amount_total|floatformat:6 }}</div>
      </div>
      <div class="p-4 bg-white rounded-lg shadow-sm">
        <div class="text-sm text-gray-500">روابط سريعة</div>
        <div class="flex flex-wrap gap-2 text-sm">
          <a href="{% url 'management:users' %}" class="text-blue-600 hover:underline">المستخدمون</a>
          <a href="{% url 'management:platforms' %}" class="text-blue-600 hover:underline">المنصات</a>
          <a href="{% url 'management:wallets' %}" class="text-blue-600 hover:underline">المحافظ</a>
          <a href="{% url 'management:deposits' %}" class="text-blue-600 hover:underline">الإيداعات</a>
          <a href="{% url 'management:withdrawals' %}" class="text-blue-600 hover:underline">السحوبات</a>
          <a href="{% url 'management:transfers' %}" class="text-blue-600 hover:underline">التحويلات</a>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="p-4 border-b text-sm font-semibold text-gray-700">آخر المستخدمين</div>
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-500">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th class="px-4 py-3">المستخدم</th>
                <th class="px-4 py-3">البريد</th>
                <th class="px-4 py-3">التاريخ</th>
              </tr>
            </thead>
            <tbody>
              {% for u in recent_users %}
              <tr class="border-b">
                <td class="px-4 py-3 font-medium text-gray-900">{{ u.username }}</td>
                <td class="px-4 py-3">{{ u.email|default:"-" }}</td>
                <td class="px-4 py-3">{{ u.date_joined|date:"Y-m-d H:i" }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="3" class="px-4 py-6 text-center text-gray-500">لا توجد بيانات.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="p-4 border-b text-sm font-semibold text-gray-700">آخر الإيداعات</div>
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-500">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th class="px-4 py-3">المستخدم</th>
                <th class="px-4 py-3">المبلغ</th>
                <th class="px-4 py-3">الحالة</th>
                <th class="px-4 py-3">التاريخ</th>
              </tr>
            </thead>
            <tbody>
              {% for d in recent_deposits %}
              <tr class="border-b">
                <td class="px-4 py-3 font-medium text-gray-900">{{ d.wallet.user.username }}</td>
                <td class="px-4 py-3">{{ d.amount|floatformat:6 }}</td>
                <td class="px-4 py-3">{{ d.get_status_display }}</td>
                <td class="px-4 py-3">{{ d.created_at|date:"Y-m-d H:i" }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="4" class="px-4 py-6 text-center text-gray-500">لا توجد بيانات.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="p-4 border-b text-sm font-semibold text-gray-700">آخر السحوبات</div>
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-500">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th class="px-4 py-3">المستخدم</th>
                <th class="px-4 py-3">المبلغ</th>
                <th class="px-4 py-3">الحالة</th>
                <th class="px-4 py-3">التاريخ</th>
              </tr>
            </thead>
            <tbody>
              {% for w in recent_withdrawals %}
              <tr class="border-b">
                <td class="px-4 py-3 font-medium text-gray-900">{{ w.user.username }}</td>
                <td class="px-4 py-3">{{ w.amount|floatformat:6 }}</td>
                <td class="px-4 py-3">{{ w.get_status_display }}</td>
                <td class="px-4 py-3">{{ w.created_at|date:"Y-m-d H:i" }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="4" class="px-4 py-6 text-center text-gray-500">لا توجد بيانات.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm overflow-hidden">
        <div class="p-4 border-b text-sm font-semibold text-gray-700">آخر التحويلات</div>
        <div class="overflow-x-auto">
          <table class="w-full text-sm text-left text-gray-500">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th class="px-4 py-3">المرسل</th>
                <th class="px-4 py-3">المستلم</th>
                <th class="px-4 py-3">المبلغ</th>
                <th class="px-4 py-3">التاريخ</th>
              </tr>
            </thead>
            <tbody>
              {% for t in recent_transfers %}
              <tr class="border-b">
                <td class="px-4 py-3 font-medium text-gray-900">{{ t.user.username }}</td>
                <td class="px-4 py-3">{{ t.to_user.username }}</td>
                <td class="px-4 py-3">{{ t.amount|floatformat:6 }}</td>
                <td class="px-4 py-3">{{ t.created_at|date:"Y-m-d H:i" }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="4" class="px-4 py-6 text-center text-gray-500">لا توجد بيانات.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</section>
{% endblock content %}
