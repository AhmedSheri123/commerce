{% extends "base.html" %}
{% load static %}
{% block content %}

<!-- Page Background -->
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 py-10">

  <div class="max-w-6xl mx-auto px-4 space-y-8">

    <!-- Statistics Summary -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-5">

      <div class="rounded-2xl bg-blue-600 text-white p-6 text-center shadow-sm transition hover:scale-[1.02]">
        <div class="text-sm opacity-90">Total Referrals</div>
        <div class="mt-2 text-4xl font-bold">{{ total_referrals }}</div>
      </div>

      <div class="rounded-2xl bg-emerald-600 text-white p-6 text-center shadow-sm transition hover:scale-[1.02]">
        <div class="text-sm opacity-90">Total Bonuses</div>
        <div class="mt-2 text-4xl font-bold">
          {{ total_bonus|floatformat:2 }} $
        </div>
      </div>

      <div class="rounded-2xl bg-gray-800 text-white p-6 text-center shadow-sm transition hover:scale-[1.02]">
        <div class="text-sm opacity-90">Invite Code</div>
        <div class="mt-3 text-3xl font-bold tracking-widest">
          {{ request.user.profile.invite_code }}
        </div>
      </div>

    </div>

    <!-- Invite Code -->
    {% if user.is_authenticated %}
    <div class="rounded-2xl bg-white border border-slate-200 shadow-sm p-6 text-center">
      <h2 class="text-xl font-semibold text-slate-800 mb-4">
        Share Referral Code
      </h2>

      <div class="rounded-xl bg-slate-50 border border-dashed border-blue-300 p-5 space-y-3">
        <div
          id="inviteCode"
          class="text-2xl font-bold text-blue-600 tracking-widest"
        >
          {{ user.profile.invite_code }}
        </div>

        <p class="text-slate-600 text-sm">
          Share this code with your friends and earn bonuses when they join.
        </p>

        <button
          onclick="copyCode()"
          class="inline-flex items-center gap-2 rounded-full bg-blue-600 px-6 py-2 text-sm font-semibold text-white transition hover:bg-blue-700"
        >
          📋 Copy Code
        </button>
      </div>
    </div>

    <script>
      function copyCode() {
        const code = document.getElementById("inviteCode").innerText;
        navigator.clipboard.writeText(code);
        alert("✅ Referral code copied successfully");
      }
    </script>
    {% endif %}

    <!-- Referrals Table -->
    <div class="rounded-2xl bg-white border border-slate-200 shadow-sm overflow-hidden">

      <div class="bg-slate-800 px-6 py-4">
        <h5 class="text-white font-semibold">Referrals Details</h5>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full text-sm text-right">
          <thead class="bg-slate-100 text-slate-700">
            <tr>
              <th class="px-4 py-3">#</th>
              <th class="px-4 py-3">User</th>
              <th class="px-4 py-3">Bonus</th>
              <th class="px-4 py-3">Description</th>
              <th class="px-4 py-3">Date</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-slate-200">

            {% for bonus in referral_bonuses %}
            <tr class="hover:bg-blue-50/60 transition">
              <td class="px-4 py-3">{{ forloop.counter }}</td>

              <td class="px-4 py-3 font-medium text-slate-800">
                {{ bonus.referred_user.username }}
              </td>

              <td class="px-4 py-3">
                <span class="inline-flex items-center rounded-full bg-emerald-100 px-3 py-1 text-emerald-700 text-xs font-semibold">
                  + {{ bonus.amount }} $
                </span>
              </td>

              <td class="px-4 py-3 text-slate-600">
                {{ bonus.description }}
              </td>

              <td class="px-4 py-3 text-slate-500">
                {{ bonus.created_at|date:"Y-m-d H:i" }}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" class="px-6 py-12 text-center text-slate-400">
                <div class="text-4xl mb-2">📭</div>
                No referrals yet
              </td>
            </tr>
            {% endfor %}

          </tbody>
        </table>
      </div>

    </div>

  </div>
</div>

{% endblock content %}

